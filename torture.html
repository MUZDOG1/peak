<!DOCTYPE html>
<html>
  <head>
    <title>Manhunt-like 3D HTML Game</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #blocker {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #instructions {
        font-size: 36px;
        color: white;
        cursor: pointer;
      }
      #gameOver {
        display: none;
        position: absolute;
        top: 40%;
        left: 40%;
        font-size: 48px;
        color: red;
      }
    </style>
  </head>
  <body>
    <div id="blocker">
      <div id="instructions">Click to play</div>
    </div>
    <div id="gameOver">Game Over</div>
    <script type="module">
      // Import Three.js and PointerLockControls
      import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js';
      import { PointerLockControls } from 'https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/controls/PointerLockControls.js';

      let camera, scene, renderer, controls, enemy;
      let moveForward = false;
      let moveBackward = false;
      let moveLeft = false;
      let moveRight = false;
      let velocity = new THREE.Vector3();
      let direction = new THREE.Vector3();
      let prevTime = performance.now();

      init();
      animate();

      function init() {
        // Set up camera and scene
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xaaaaaa);
        scene.fog = new THREE.Fog(0xffffff, 0, 750);

        // Lighting
        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444);
        hemiLight.position.set(0, 200, 0);
        scene.add(hemiLight);

        const dirLight = new THREE.DirectionalLight(0xffffff);
        dirLight.position.set(0, 200, 100);
        dirLight.castShadow = true;
        dirLight.shadow.camera.top = 180;
        dirLight.shadow.camera.bottom = -100;
        dirLight.shadow.camera.left = -120;
        dirLight.shadow.camera.right = 120;
        scene.add(dirLight);

        // Floor: a simple wireframe plane
        const floorGeometry = new THREE.PlaneGeometry(2000, 2000, 100, 100);
        const floorMaterial = new THREE.MeshBasicMaterial({ color: 0x999999, wireframe: true });
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.rotation.x = - Math.PI / 2;
        scene.add(floor);

        // Enemy: a red cube that will chase you
        const enemyGeometry = new THREE.BoxGeometry(20, 20, 20);
        const enemyMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
        enemy = new THREE.Mesh(enemyGeometry, enemyMaterial);
        enemy.position.set(50, 10, -50);
        scene.add(enemy);

        // Renderer
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // PointerLockControls for first-person movement
        controls = new PointerLockControls(camera, document.body);
        scene.add(controls.getObject());

        const blocker = document.getElementById('blocker');
        const instructions = document.getElementById('instructions');

        instructions.addEventListener('click', function () {
          controls.lock();
        }, false);

        controls.addEventListener('lock', function () {
          blocker.style.display = 'none';
        });

        controls.addEventListener('unlock', function () {
          blocker.style.display = 'flex';
        });

        // Keyboard controls
        const onKeyDown = function (event) {
          switch (event.code) {
            case 'ArrowUp':
            case 'KeyW':
              moveForward = true;
              break;
            case 'ArrowLeft':
            case 'KeyA':
              moveLeft = true;
              break;
            case 'ArrowDown':
            case 'KeyS':
              moveBackward = true;
              break;
            case 'ArrowRight':
            case 'KeyD':
              moveRight = true;
              break;
          }
        };

        const onKeyUp = function (event) {
          switch (event.code) {
            case 'ArrowUp':
            case 'KeyW':
              moveForward = false;
              break;
            case 'ArrowLeft':
            case 'KeyA':
              moveLeft = false;
              break;
            case 'ArrowDown':
            case 'KeyS':
              moveBackward = false;
              break;
            case 'ArrowRight':
            case 'KeyD':
              moveRight = false;
              break;
          }
        };

        document.addEventListener('keydown', onKeyDown, false);
        document.addEventListener('keyup', onKeyUp, false);
        window.addEventListener('resize', onWindowResize, false);
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function animate() {
        requestAnimationFrame(animate);

        if (controls.isLocked === true) {
          const time = performance.now();
          const delta = (time - prevTime) / 1000;

          // Update player movement
          velocity.x -= velocity.x * 10.0 * delta;
          velocity.z -= velocity.z * 10.0 * delta;

          direction.z = Number(moveForward) - Number(moveBackward);
          direction.x = Number(moveRight) - Number(moveLeft);
          direction.normalize(); // ensures consistent movement in all directions

          if (moveForward || moveBackward) velocity.z -= direction.z * 400.0 * delta;
          if (moveLeft || moveRight) velocity.x -= direction.x * 400.0 * delta;

          controls.moveRight(- velocity.x * delta);
          controls.moveForward(- velocity.z * delta);

          // Simple enemy chasing behavior
          const playerPosition = controls.getObject().position;
          const enemyDirection = new THREE.Vector3();
          enemyDirection.subVectors(playerPosition, enemy.position).normalize();
          enemy.position.add(enemyDirection.multiplyScalar(50 * delta));

          // Collision detection (if enemy gets too close, game over)
          if (enemy.position.distanceTo(playerPosition) < 10) {
            document.getElementById('gameOver').style.display = 'block';
            controls.unlock();
          }

          prevTime = time;
        }

        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>

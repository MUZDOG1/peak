<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RAGE SIMULATOR with House Objects</title>
  <style>
    body {
      margin: 0;
      background: #1a0a0a;
      color: #ff4444;
      font-family: 'Courier New', monospace;
      text-align: center;
      overflow: hidden;
      cursor: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABFklEQVRYR+2X0Q6DIAiF8d8b9A6dwtZSFBT8/0ndQNiJjVH6MehWQhYchH0ZytISkZER0XsVowN5iPEApNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUNAJ5cBCUPAvBQ8vAJ+uJAAAAAASUVORK5CYII='), auto;
    }
    #gameCanvas {
      background: #222;
      display: block;
      margin: 20px auto;
      border: 3px solid #444;
      position: relative;
    }
    h1 {
      font-size: 3em;
      text-shadow: 2px 2px 0 #000;
      margin: 10px 0;
      color: #ff5555;
    }
    #instructions {
      background: #300000;
      border: 1px solid #ff4444;
      padding: 10px;
      margin: 10px auto;
      width: 300px;
      color: #ffaaaa;
    }
    #healthBar {
      width: 200px;
      height: 20px;
      background: #300000;
      margin: 10px auto;
      border: 1px solid #ff4444;
    }
    #healthFill {
      height: 100%;
      width: 100%;
      background: #ff0000;
    }
  </style>
</head>
<body>
  <h1>RAGE SIMULATOR</h1>
  <div id="instructions">ARROW KEYS: Move | SPACE: Attack</div>
  <div id="healthBar"><div id="healthFill"></div></div>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    // ====================
    //   CANVAS & CONTEXT
    // ====================
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const healthFill = document.getElementById('healthFill');

    // ====================
    //   IMAGES
    // ====================
    // 1) Background: your house image
    //    Replace "house_background.png" with the actual filename/path of your image
    const backgroundImage = new Image();
    backgroundImage.src = 'house_background.png';

    // 2) Player & Enemy Sprites
    const playerImage = new Image();
    playerImage.src = 'idle.png';

    const punchImage = new Image();
    punchImage.src = 'punch.png';

    const enemyIdleImage = new Image();
    enemyIdleImage.src = 'enemyidle.png';

    const enemyHitImage = new Image();
    enemyHitImage.src = 'hit.png';

    // ====================
    //   GAME STATE
    // ====================
    let enemyHealth = 100;
    let lastAttackTime = 0;

    // ====================
    //   ENTITIES
    // ====================
    const player = {
      x: 100,
      y: 300,
      width: 50,
      height: 50,
      speed: 5,
      isPunching: false
    };

    const enemy = {
      x: 600,
      y: 300,
      width: 50,
      height: 50,
      isHurt: false,
      knockbackVelocity: { x: 0, y: 0 },
      knockbackDuration: 0
    };

    // ====================
    //   COLLISION BOXES
    // ====================
    // Each object that shouldn't be passable is a rectangle:
    // (x, y, width, height). Adjust these so they line up
    // correctly with your drawn walls, couch, and TV.
    const walls = [
      // Example "house wall" bounding box:
      { x: 0,   y: 0,   width: 800, height: 50  },  // Top edge
      { x: 0,   y: 0,   width: 50,  height: 600 },  // Left edge
      { x: 750, y: 0,   width: 50,  height: 600 },  // Right edge
      { x: 0,   y: 550, width: 800, height: 50  },  // Bottom edge

      // Example "couch" bounding box (the red item):
      // Tweak these numbers to match your couch's position
      { x: 620, y: 250, width: 80, height: 50 },

      // Example "TV" bounding box (the black rectangle):
      { x: 730, y: 200, width: 20, height: 80 },

      // You can add more bounding boxes for other furniture or walls
      // { x: someX, y: someY, width: someW, height: someH }
    ];

    // ====================
    //   INPUT HANDLING
    // ====================
    const keys = {};
    document.addEventListener('keydown', (e) => keys[e.key] = true);
    document.addEventListener('keyup', (e) => keys[e.key] = false);

    // ====================
    //   COLLISION CHECK
    // ====================
    function isColliding(rect1, rect2) {
      return (
        rect1.x < rect2.x + rect2.width &&
        rect1.x + rect1.width > rect2.x &&
        rect1.y < rect2.y + rect2.height &&
        rect1.y + rect1.height > rect2.y
      );
    }

    // Try to move an entity; revert if colliding with a wall
    function moveEntity(entity, dx, dy) {
      const originalX = entity.x;
      const originalY = entity.y;

      // Attempt movement
      entity.x += dx;
      entity.y += dy;

      // Check collisions against all walls
      for (const wall of walls) {
        if (isColliding(entity, wall)) {
          // If collided, revert to original position
          entity.x = originalX;
          entity.y = originalY;
          break;
        }
      }
    }

    // ====================
    //   ATTACK LOGIC
    // ====================
    function attack() {
      const now = Date.now();
      if (now - lastAttackTime < 500) return; // Attack cooldown

      // Distance check
      const playerCenterX = player.x + player.width / 2;
      const playerCenterY = player.y + player.height / 2;
      const enemyCenterX = enemy.x + enemy.width / 2;
      const enemyCenterY = enemy.y + enemy.height / 2;
      const dx = playerCenterX - enemyCenterX;
      const dy = playerCenterY - enemyCenterY;
      const distance = Math.sqrt(dx * dx + dy * dy);

      // If close enough
      if (distance < 100) {
        player.isPunching = true;
        setTimeout(() => (player.isPunching = false), 200);

        enemy.isHurt = true;

        // Knockback
        const knockbackIntensity = 15;
        const knockbackDuration = 15;
        const mag = Math.sqrt(dx * dx + dy * dy);

        enemy.knockbackVelocity.x = -(dx / mag) * knockbackIntensity;
        enemy.knockbackVelocity.y = -(dy / mag) * knockbackIntensity;
        enemy.knockbackDuration = knockbackDuration;

        // Decrease health
        enemyHealth -= 10;
        healthFill.style.width = `${enemyHealth}%`;

        if (enemyHealth <= 0) {
          enemyHealth = 100;
          setTimeout(() => (healthFill.style.width = '100%'), 500);
        }

        lastAttackTime = now;
        setTimeout(() => (enemy.isHurt = false), 1000);
      }
    }

    // ====================
    //   GAME LOOP
    // ====================
    function update() {
      // Player movement
      let moveX = 0,
          moveY = 0;
      if (keys['ArrowUp'])    moveY = -player.speed;
      if (keys['ArrowDown'])  moveY =  player.speed;
      if (keys['ArrowLeft'])  moveX = -player.speed;
      if (keys['ArrowRight']) moveX =  player.speed;

      // Move player with collision checks
      moveEntity(player, moveX, moveY);

      // Attack
      if (keys[' ']) attack();

      // Enemy knockback or random movement
      if (enemy.knockbackDuration > 0) {
        moveEntity(enemy, enemy.knockbackVelocity.x, enemy.knockbackVelocity.y);
        enemy.knockbackVelocity.x *= 0.9;
        enemy.knockbackVelocity.y *= 0.9;
        enemy.knockbackDuration--;
      } else {
        // Random wandering
        if (Math.random() < 0.02) {
          const randX = Math.random() * 6 - 3;
          const randY = Math.random() * 6 - 3;
          moveEntity(enemy, randX, randY);
        }
      }

      // Keep both within canvas
      player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
      player.y = Math.max(0, Math.min(canvas.height - player.height, player.y));
      enemy.x  = Math.max(0, Math.min(canvas.width - enemy.width, enemy.x));
      enemy.y  = Math.max(0, Math.min(canvas.height - enemy.height, enemy.y));
    }

    function draw() {
      // Draw the background
      if (backgroundImage.complete) {
        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
      } else {
        ctx.fillStyle = '#333';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      // (Optional) Draw collision boxes for debugging
      // Comment out if you don't want to see them.
      /*
      ctx.save();
      ctx.globalAlpha = 0.3;
      ctx.fillStyle = '#FF0000';
      for (const wall of walls) {
        ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
      }
      ctx.restore();
      */

      // Draw enemy
      if (enemy.isHurt && enemyHitImage.complete) {
        ctx.drawImage(enemyHitImage, enemy.x, enemy.y, enemy.width, enemy.height);
      } else if (enemyIdleImage.complete) {
        ctx.drawImage(enemyIdleImage, enemy.x, enemy.y, enemy.width, enemy.height);
      } else {
        ctx.fillStyle = enemy.isHurt ? '#ff9999' : '#ff0000';
        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
      }

      // Draw player
      if (player.isPunching && punchImage.complete) {
        ctx.drawImage(punchImage, player.x, player.y, player.width, player.height);
      } else if (playerImage.complete) {
        ctx.drawImage(playerImage, player.x, player.y, player.width, player.height);
      } else {
        ctx.fillStyle = '#3498db';
        ctx.fillRect(player.x, player.y, player.width, player.height);
      }

      // (Optional) draw an indicator if within attack range
      const playerCenterX = player.x + player.width / 2;
      const playerCenterY = player.y + player.height / 2;
      const enemyCenterX = enemy.x + enemy.width / 2;
      const enemyCenterY = enemy.y + enemy.height / 2;
      const dx = playerCenterX - enemyCenterX;
      const dy = playerCenterY - enemyCenterY;
      const distance = Math.sqrt(dx * dx + dy * dy);
      if (distance < 100) {
        ctx.strokeStyle = '#ff0000';
        ctx.lineWidth = 2;
        ctx.strokeRect(enemy.x - 5, enemy.y - 5, enemy.width + 10, enemy.height + 10);
      }
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    // Start the loop
    gameLoop();
  </script>
</body>
</html>
